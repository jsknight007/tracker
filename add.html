<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Log Expense</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; max-width: 500px; margin: 0 auto; padding: 2rem 1rem; background: #f0f2f5; }
    .container { background: white; padding: 1.5rem; border-radius: 24px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); text-align: center; }
    h1 { margin-bottom: 1.5rem; color: #1a73e8; font-size: 1.2rem; letter-spacing: 0.5px; }
    
    .input-group { display: flex; gap: 8px; margin-bottom: 1rem; }
    input { flex: 1; padding: 1rem; border: 2px solid #e4e6eb; border-radius: 12px; font-size: 1rem; outline: none; min-width: 0; }
    input:focus { border-color: #1a73e8; }
    
    button#submitBtn { width: 56px; height: 56px; background: #1a73e8; color: white; border: none; border-radius: 12px; cursor: pointer; font-size: 1.4rem; flex-shrink: 0; }
    button:active { transform: scale(0.95); }

    .chips { margin-bottom: 1.5rem; }
    .chip { padding: 8px 14px; background: #f0f2f5; border-radius: 10px; font-size: 0.85rem; color: #444; display: inline-block; margin: 4px; cursor: pointer; border: 1px solid transparent; }
    .chip:active { background: #e4e6eb; border-color: #ccc; }

    #status { margin: 1rem 0; padding: 10px; border-radius: 10px; font-size: 0.9rem; font-weight: 600; display: none; }
    .success { background: #e6f4ea; color: #137333; display: block !important; }
    .sending { background: #e8f0fe; color: #1967d2; display: block !important; }

    .undo-link { color: #c5221f; font-size: 0.8rem; text-decoration: none; font-weight: 600; cursor: pointer; opacity: 0.7; }
  </style>
</head>
<body>

<div class="container">
  <h1>NEW ENTRY</h1>
  
  <div class="input-group">
    <input type="text" id="cmd" placeholder="Store Amount Card" autocomplete="off" spellcheck="false">
    <button id="submitBtn" onclick="send()">ðŸ“¤</button>
  </div>

  <div class="chips">
    <span class="chip" onclick="add('Citi')">Citi</span>
    <span class="chip" onclick="add('Discover')">Discover</span>
    <span class="chip" onclick="add('Costco')">Costco</span>
    <span class="chip" onclick="add('Yesterday')">Yesterday</span>
  </div>

  <div id="status"></div>
  <div class="undo-link" onclick="undo()">Oops! Delete Last Entry</div>
</div>

<script>
  const WEB_APP_URL = localStorage.getItem('WEB_APP_URL') || "";
  const input = document.getElementById('cmd');

  function add(val) {
    input.value += (input.value ? " " : "") + val;
    input.focus();
  }

  async function send() {
    const val = input.value.trim();
    if (!val || !WEB_APP_URL) return;
    
    msg("Logging...", "sending");
    try {
      await fetch(WEB_APP_URL, {
        method: "POST", mode: "no-cors",
        body: new URLSearchParams({ 'command': val })
      });
      msg("âœ… Saved", "success");
      input.value = "";
    } catch (e) { alert("Error connecting to script."); }
  }

  function msg(t, c) {
    const s = document.getElementById('status');
    s.textContent = t; s.className = c;
    if (c === 'success') setTimeout(() => s.className = '', 3000);
  }

  async function undo() {
    if (confirm("Delete last entry?")) {
      await fetch(`${WEB_APP_URL}?action=deleteLast`);
      msg("ðŸ—‘ï¸ Deleted", "success");
    }
  }

  input.addEventListener("keypress", (e) => { if (e.key === "Enter") send(); });
</script>

</body>
</html>
